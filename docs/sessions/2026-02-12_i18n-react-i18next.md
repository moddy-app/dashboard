# Session : Internationalisation (i18n) avec react-i18next

## Date
2026-02-12

## Objectif
Implémenter un système d'internationalisation complet pour le dashboard Moddy avec react-i18next, supportant l'anglais et le français, avec détection automatique de la langue navigateur et persistance des préférences via cookie.

## Tâches accomplies

### 1. Installation des dépendances
- `react-i18next` — Intégration React pour i18next (hook `useTranslation`)
- `i18next` — Moteur de traduction

### 2. Création des fichiers de traduction
- **`src/locales/en/translation.json`** — ~100 clés de traduction anglaises
- **`src/locales/fr/translation.json`** — ~100 clés de traduction françaises
- Organisation par page/section : `home.*`, `debug.*` (auth, api, router, browser, performance, cookies, storage, logs, sentry, components), `common.*`

### 3. Configuration i18n
- **`src/i18n.ts`** — Initialisation de i18next avec :
  - Ressources statiques (en/fr)
  - Détection de la langue : cookie → navigateur → fallback (en)
  - `escapeValue: false` (React gère l'échappement)

### 4. Système de préférences utilisateur
- **`src/lib/preferences.ts`** — Utilitaires pour le cookie `moddy_preferences` :
  - `getPreferences()` — Lit le cookie JSON
  - `setPreferences()` — Met à jour le cookie (merge avec l'existant)
  - `detectBrowserLanguage()` — Détecte la langue du navigateur parmi les supportées
- Cookie extensible pour futures préférences (ex: `theme: "dark"`)

### 5. Traduction des composants
- **`HomePage.tsx`** — 3 textes traduits via `useTranslation()`
- **`DebugPage.tsx`** — ~60 textes traduits + sélecteur de langue Auto/EN/FR

### 6. Sélecteur de langue (DebugPage)
- 3 boutons : **Auto** | **EN** | **FR**
- Auto = détection navigateur (supprime la préférence du cookie)
- EN/FR = force la langue et sauvegarde dans le cookie
- Bouton actif mis en surbrillance avec `bg-primary`

## Fichiers créés
| Fichier | Description |
|---------|-------------|
| `app/src/i18n.ts` | Configuration react-i18next |
| `app/src/locales/en/translation.json` | Traductions anglaises |
| `app/src/locales/fr/translation.json` | Traductions françaises |
| `app/src/lib/preferences.ts` | Utilitaires cookie préférences |
| `docs/sessions/2026-02-12_i18n-react-i18next.md` | Ce fichier |

## Fichiers modifiés
| Fichier | Changement |
|---------|------------|
| `app/src/main.tsx` | Ajout `import './i18n'` |
| `app/src/pages/HomePage.tsx` | Hook `useTranslation()` + remplacement textes |
| `app/src/pages/DebugPage.tsx` | Hook `useTranslation()` + sélecteur langue + cookie |
| `app/package.json` | Ajout `react-i18next` + `i18next` |
| `docs/CLAUDE.md` | Documentation complète i18n + préférences |
| `docs/sessions/README.md` | Ajout de cette session dans l'index |

## Décisions techniques

1. **Pas de traduction des composants showcase** (`component-example.tsx`) — Ce sont des textes de démonstration, pas du contenu utilisateur
2. **Pas de traduction des logs console** — Les messages de debug restent en anglais (standard dev)
3. **Cookie JSON extensible** — `moddy_preferences` peut accueillir `language`, `theme`, etc.
4. **Mode Auto supprime la clé** — Quand l'utilisateur choisit "Auto", `language` est retiré du cookie pour revenir à la détection navigateur

## Logique de résolution de la langue

```
1. Cookie `moddy_preferences.language` existe ?
   → OUI : utilise cette langue
   → NON : passe à l'étape 2

2. `navigator.languages` contient une langue supportée ?
   → OUI : utilise la première trouvée
   → NON : fallback "en"
```

## Technologies utilisées
- **react-i18next** — Hook `useTranslation()` pour l'accès aux traductions dans React
- **i18next** — Moteur de traduction avec interpolation (`{{variable}}`)
- **Cookie natif** — Pas de bibliothèque externe, lecture/écriture via `document.cookie`

## Prochaines étapes
- Ajouter d'autres langues si nécessaire (es, de, etc.)
- Implémenter le dark/light mode dans le cookie `moddy_preferences`
- Déplacer le sélecteur de langue dans la navbar quand elle existera
- Traduire les futures pages au fur et à mesure de leur création
